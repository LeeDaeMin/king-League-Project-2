// src/middleware/serve-static/bun.ts
import { existsSync } from "fs";
import { getFilePath } from "../../utils/filepath.js";
import { getMimeType } from "../../utils/mime.js";
var { file } = Bun;
var DEFAULT_DOCUMENT = "index.html";
var serveStatic = (options = { root: "" }) => {
  return async (c, next) => {
    if (c.finalized) {
      await next();
      return;
    }
    const url = new URL(c.req.url);
    let path = getFilePath({
      filename: options.path ?? url.pathname,
      root: options.root,
      defaultDocument: DEFAULT_DOCUMENT
    });
    path = `./${path}`;
    if (existsSync(path)) {
      const content = file(path);
      if (content) {
        const mimeType = getMimeType(path);
        if (mimeType) {
          c.header("Content-Type", mimeType);
        }
        return c.body(content);
      }
    }
    console.warn(`Static file: ${path} is not found`);
    await next();
    return;
  };
};
export {
  serveStatic
};
